# Historias de Usuario - BackupGuard Pro

## üìã Informaci√≥n General
- **Proyecto**: Sistema de Monitoreo y Gesti√≥n de Copias de Seguridad
- **Metodolog√≠a**: Shape Up
- **Fecha de Creaci√≥n**: 16 de agosto de 2025
- **Status General**: En Planificaci√≥n

---

## üèóÔ∏è HU 0: Dise√±o Arquitect√≥nico del Sistema (ARQUITECTURA OBLIGATORIA)

### üìä Estado
- **Status**: üî¥ Pending
- **Prioridad**: Cr√≠tica (Bloqueante)
- **Estimaci√≥n**: 2 semanas
- **Dependencias**: Ninguna
- **Sprint**: Sprint 1

### üìù Descripci√≥n Funcional
**Como** arquitecto de software del proyecto BackupGuard Pro  
**Quiero** dise√±ar la arquitectura completa del sistema de microservicios  
**Para que** el desarrollo se base en fundamentos s√≥lidos, escalables y bien documentados que gu√≠en todas las decisiones t√©cnicas futuras.

### üéØ Criterios de Aceptaci√≥n

#### ‚úÖ AC1: Diagramas C4 Completos
**Dado** que necesitamos documentar la arquitectura del sistema  
**Cuando** complete el dise√±o arquitect√≥nico  
**Entonces** debe incluir:
- C1 (System Context): Interacci√≥n con sistemas externos
- C2 (Container): Todos los microservicios y sus relaciones
- C3 (Component): Detalle interno de servicios cr√≠ticos
- C4 (Code): Clases principales y patrones de dise√±o

#### ‚úÖ AC2: Especificaci√≥n de APIs
**Dado** que los microservicios deben comunicarse entre s√≠  
**Cuando** defina las interfaces de servicio  
**Entonces** debe especificar:
- Endpoints REST para cada servicio
- Schemas de request/response con Zod
- C√≥digos de error estandarizados
- Documentaci√≥n OpenAPI/Swagger

#### ‚úÖ AC3: Modelo de Datos Distribuido
**Dado** que usaremos MongoDB en m√∫ltiples servicios  
**Cuando** dise√±e el modelo de datos  
**Entonces** debe definir:
- Schemas de MongoDB para cada servicio
- Estrategias de consistencia eventual
- √çndices para performance
- Estrategias de backup y recovery

### üîß Especificaciones T√©cnicas

#### Arquitectura de Microservicios
```typescript
interface SystemArchitecture {
  services: {
    apiGateway: {
      technology: "Kong/Express Gateway";
      port: 8080;
      responsibilities: ["routing", "authentication", "rateLimiting"];
    };
    userService: {
      technology: "Node.js + Express + MongoDB";
      port: 3001;
      responsibilities: ["userManagement", "authentication", "organizations"];
    };
    backupMonitorService: {
      technology: "Node.js + Express + MongoDB + WebSocket";
      port: 3002;
      responsibilities: ["backupMonitoring", "integrityValidation", "realTimeAlerts"];
    };
    // ... otros servicios
  };
}
```

#### Diagramas C4

**C1 - System Context**
```mermaid
graph TB
    User[Usuario Final<br/>Monitorea sus backups] --> BackupGuard[BackupGuard Pro<br/>Sistema de Monitoreo]
    Admin[Administrador<br/>Gestiona la organizaci√≥n] --> BackupGuard
    ClientMachine[M√°quinas Cliente<br/>Env√≠an datos de backup] --> BackupGuard
    BackupGuard --> EmailProvider[Proveedor Email<br/>SendGrid/AWS SES]
    BackupGuard --> SMSProvider[Proveedor SMS<br/>Twilio]
    BackupGuard --> CloudStorage[Cloud Storage<br/>AWS S3/Azure Blob]
    BackupGuard --> PaymentGateway[Gateway de Pagos<br/>Stripe]
```

**C2 - Container Diagram**
```mermaid
graph TB
    subgraph "Cliente"
        WebApp[Web Application<br/>React + TypeScript]
        MobileApp[Mobile App<br/>React Native]
        ClientAgent[Client Agent<br/>Go Executable]
    end
    
    subgraph "BackupGuard Pro System"
        APIGateway[API Gateway<br/>Kong/Express]
        
        UserService[User Service<br/>Node.js + Express]
        BackupService[Backup Monitor Service<br/>Node.js + WebSocket]
        NotificationService[Notification Service<br/>Node.js + Queue]
        ReportService[Report Service<br/>Node.js + PDF]
        ConfigService[Config Service<br/>Node.js + Express]
        
        MongoDB[(MongoDB<br/>Primary Database)]
        Redis[(Redis<br/>Cache + Sessions)]
        MessageQueue[RabbitMQ<br/>Async Processing]
    end
    
    WebApp --> APIGateway
    MobileApp --> APIGateway
    ClientAgent --> APIGateway
    
    APIGateway --> UserService
    APIGateway --> BackupService
    APIGateway --> NotificationService
    APIGateway --> ReportService
    APIGateway --> ConfigService
    
    UserService --> MongoDB
    BackupService --> MongoDB
    BackupService --> Redis
    NotificationService --> MessageQueue
    ReportService --> MongoDB
```

### üìã Tareas de Implementaci√≥n

- [ ] **Tarea 0.1** (Arquitecto): Crear diagramas C4 completos en Mermaid/Draw.io
- [ ] **Tarea 0.2** (Arquitecto): Definir modelo de datos MongoDB para cada servicio
- [ ] **Tarea 0.3** (Arquitecto): Especificar APIs REST con OpenAPI/Swagger
- [ ] **Tarea 0.4** (Arquitecto): Dise√±ar estrategia de comunicaci√≥n entre servicios
- [ ] **Tarea 0.5** (DevOps): Definir arquitectura de deployment y CI/CD
- [ ] **Tarea 0.6** (UX): Crear wireframes y prototipos de UI principales
- [ ] **Tarea 0.7** (Arquitecto): Especificar estrategia de seguridad y autenticaci√≥n
- [ ] **Tarea 0.8** (DevOps): Definir m√©tricas de monitoreo y observabilidad
- [ ] **Tarea 0.9** (QA): Actualizar documentaci√≥n del proyecto con nuevos diagramas

---

## üîê HU 1: Sistema de Autenticaci√≥n y Autorizaci√≥n

### üìä Estado
- **Status**: üî¥ Pending
- **Prioridad**: Alta
- **Estimaci√≥n**: 1.5 semanas
- **Dependencias**: HU 0 (Arquitectura)
- **Sprint**: Sprint 2

### üìù Descripci√≥n Funcional
**Como** usuario del sistema (administrador o usuario final)  
**Quiero** un sistema de autenticaci√≥n seguro y una experiencia de login simplificada  
**Para que** pueda acceder a las funcionalidades del sistema de manera segura y sin fricciones.

### üéØ Criterios de Aceptaci√≥n

#### ‚úÖ AC1: Registro de Nueva Organizaci√≥n
**Dado** que soy un nuevo usuario que quiere usar BackupGuard  
**Cuando** complete el proceso de registro  
**Entonces** debo poder:
- Crear una cuenta con email y contrase√±a segura
- Verificar mi email autom√°ticamente
- Acceder inmediatamente a un workspace b√°sico
- Ver tutorial de onboarding

#### ‚úÖ AC2: Autenticaci√≥n JWT Segura
**Dado** que soy un usuario registrado  
**Cuando** me loguee en el sistema  
**Entonces** debo recibir:
- Access Token JWT (vida: 15 minutos)
- Refresh Token (vida: 30 d√≠as, httpOnly cookie)
- Session management en Redis
- Capacidad de logout desde todos los dispositivos

#### ‚úÖ AC3: Gesti√≥n de Roles y Permisos
**Dado** que soy administrador de una organizaci√≥n  
**Cuando** gestione usuarios de mi organizaci√≥n  
**Entonces** debo poder:
- Invitar nuevos usuarios por email
- Asignar roles espec√≠ficos (Admin, Operator, Viewer)
- Definir permisos granulares por funcionalidad
- Revocar acceso instant√°neamente

### üîß Especificaciones T√©cnicas

#### Modelo de Datos
```typescript
interface User {
  _id: ObjectId;
  email: string;
  passwordHash: string; // bcrypt con salt rounds 12
  firstName: string;
  lastName: string;
  organizationId: ObjectId;
  role: 'admin' | 'operator' | 'viewer';
  permissions: string[];
  isEmailVerified: boolean;
  emailVerificationToken?: string;
  resetPasswordToken?: string;
  mfaEnabled: boolean;
  mfaSecret?: string;
  createdAt: Date;
  updatedAt: Date;
  lastLoginAt: Date;
}

interface Organization {
  _id: ObjectId;
  name: string;
  domain: string;
  planType: 'free' | 'premium' | 'enterprise';
  ownerId: ObjectId;
  settings: {
    maxUsers: number;
    maxMachines: number;
    features: string[];
    mfaRequired: boolean;
  };
  createdAt: Date;
  updatedAt: Date;
}

interface Session {
  _id: string;
  userId: ObjectId;
  deviceInfo: {
    userAgent: string;
    ip: string;
    location?: string;
  };
  refreshToken: string;
  expiresAt: Date;
  isActive: boolean;
}
```

#### API Endpoints
```typescript
// POST /api/auth/register
interface RegisterRequest {
  email: string;
  password: string;
  firstName: string;
  lastName: string;
  organizationName: string;
}

// POST /api/auth/login
interface LoginRequest {
  email: string;
  password: string;
  mfaCode?: string;
}

interface AuthResponse {
  user: PublicUser;
  organization: PublicOrganization;
  accessToken: string;
  // refreshToken se env√≠a como httpOnly cookie
}
```

### üìã Tareas de Implementaci√≥n

- [ ] **Tarea 1.1** (Backend): Crear User Service con estructura base
- [ ] **Tarea 1.2** (Backend): Implementar registro y verificaci√≥n de email
- [ ] **Tarea 1.3** (Backend): Crear sistema JWT con refresh tokens
- [ ] **Tarea 1.4** (Backend): Implementar middleware de autorizaci√≥n
- [ ] **Tarea 1.5** (Backend): Crear gesti√≥n de sesiones con Redis
- [ ] **Tarea 1.6** (Backend): Implementar reset de contrase√±a
- [ ] **Tarea 1.7** (Backend): Agregar soporte para MFA (opcional)
- [ ] **Tarea 1.8** (QA): Crear tests de seguridad para autenticaci√≥n
- [ ] **Tarea 1.9** (Docs): Actualizar documentaci√≥n de APIs de autenticaci√≥n

---

## üëÅÔ∏è HU 2: Servicio de Monitoreo de Backups Core

### üìä Estado
- **Status**: üî¥ Pending
- **Prioridad**: Alta
- **Estimaci√≥n**: 2 semanas
- **Dependencias**: HU 0 (Arquitectura), HU 1 (Auth)
- **Sprint**: Sprint 2-3

### üìù Descripci√≥n Funcional
**Como** administrador del sistema  
**Quiero** un servicio que monitoree autom√°ticamente el estado de las copias de seguridad en todas las m√°quinas  
**Para que** pueda tener visibilidad completa y detecci√≥n proactiva de problemas.

### üéØ Criterios de Aceptaci√≥n

#### ‚úÖ AC1: Registro Autom√°tico de M√°quinas
**Dado** que instalo el agente de BackupGuard en una nueva m√°quina  
**Cuando** el agente se inicie por primera vez  
**Entonces** debe:
- Auto-registrarse en el sistema central
- Enviar informaci√≥n del sistema (OS, hostname, IP)
- Comenzar heartbeats cada 60 segundos
- Detectar configuraciones de backup existentes

#### ‚úÖ AC2: Monitoreo de Integridad de Backups
**Dado** que una m√°quina realiza un backup  
**Cuando** el agente detecte el archivo de backup  
**Entonces** debe:
- Calcular checksum SHA-256 del archivo
- Verificar metadata y timestamps
- Validar que el backup est√© completo
- Reportar estado al servicio central via WebSocket

#### ‚úÖ AC3: Detecci√≥n Proactiva de Problemas
**Dado** que una m√°quina no ha realizado backup en el tiempo esperado  
**Cuando** se exceda el umbral configurado (24h por defecto)  
**Entonces** debe:
- Generar alerta autom√°tica de backup faltante
- Clasificar severidad (warning, error, critical)
- Enviar notificaci√≥n inmediata al notification service
- Actualizar dashboard en tiempo real

### üîß Especificaciones T√©cnicas

#### Modelo de Datos
```typescript
interface Machine {
  _id: ObjectId;
  organizationId: ObjectId;
  name: string;
  hostname: string;
  ipAddress: string;
  operatingSystem: 'windows' | 'linux' | 'macos';
  agentVersion: string;
  status: 'online' | 'offline' | 'warning' | 'error';
  lastHeartbeat: Date;
  lastBackup: Date;
  backupConfig: {
    enabled: boolean;
    schedule: string; // cron expression
    paths: string[];
    retentionDays: number;
    compressionEnabled: boolean;
    expectedMaxSize: number; // bytes
  };
  metrics: {
    cpuUsage: number;
    memoryUsage: number;
    diskSpace: DiskSpaceInfo[];
  };
  createdAt: Date;
  updatedAt: Date;
}

interface BackupExecution {
  _id: ObjectId;
  machineId: ObjectId;
  startTime: Date;
  endTime?: Date;
  status: 'running' | 'completed' | 'failed' | 'cancelled';
  backupType: 'full' | 'incremental' | 'differential';
  filesCount: number;
  totalSize: number;
  compressedSize?: number;
  checksum: string;
  backupPath: string;
  logPath?: string;
  errorMessage?: string;
  performance: {
    duration: number; // seconds
    throughput: number; // MB/s
    compressionRatio?: number;
  };
  createdAt: Date;
}

interface BackupAlert {
  _id: ObjectId;
  machineId: ObjectId;
  organizationId: ObjectId;
  type: 'backup_failed' | 'backup_missing' | 'machine_offline' | 'disk_full';
  severity: 'info' | 'warning' | 'error' | 'critical';
  message: string;
  metadata: Record<string, any>;
  isResolved: boolean;
  resolvedAt?: Date;
  resolvedBy?: ObjectId;
  createdAt: Date;
}
```

#### API Endpoints
```typescript
// WebSocket Events
interface BackupEvent {
  type: 'heartbeat' | 'backup_started' | 'backup_completed' | 'backup_failed';
  machineId: string;
  timestamp: Date;
  data: any;
}

// REST API
// GET /api/machines
interface MachinesResponse {
  machines: Machine[];
  total: number;
  pagination: PaginationInfo;
}

// GET /api/machines/:id/backups
interface BackupHistory {
  backups: BackupExecution[];
  summary: {
    totalBackups: number;
    successRate: number;
    averageDuration: number;
    lastBackup: Date;
  };
}
```

### üìã Tareas de Implementaci√≥n

- [ ] **Tarea 2.1** (Backend): Crear Backup Monitor Service con Express + WebSocket
- [ ] **Tarea 2.2** (Backend): Implementar registro y gesti√≥n de m√°quinas
- [ ] **Tarea 2.3** (Backend): Crear sistema de heartbeats y health monitoring
- [ ] **Tarea 2.4** (Backend): Implementar validador de integridad de backups
- [ ] **Tarea 2.5** (Backend): Crear detector de backups faltantes con scheduler
- [ ] **Tarea 2.6** (Backend): Implementar sistema de alertas y clasificaci√≥n
- [ ] **Tarea 2.7** (Backend): Crear event publisher para notificaciones
- [ ] **Tarea 2.8** (QA): Desarrollar tests de integraci√≥n para WebSocket
- [ ] **Tarea 2.9** (Docs): Documentar protocolos de comunicaci√≥n agente-servidor

---

## üñ•Ô∏è HU 3: Dashboard de Administraci√≥n MVP

### üìä Estado
- **Status**: üî¥ Pending
- **Prioridad**: Alta
- **Estimaci√≥n**: 2 semanas
- **Dependencias**: HU 1 (Auth), HU 2 (Backup Monitor)
- **Sprint**: Sprint 3-4

### üìù Descripci√≥n Funcional
**Como** administrador  
**Quiero** un dashboard web intuitivo y en tiempo real  
**Para que** pueda visualizar el estado de todas las m√°quinas y backups de mi organizaci√≥n desde un solo lugar.

### üéØ Criterios de Aceptaci√≥n

#### ‚úÖ AC1: Vista General de Estado (Homepage)
**Dado** que accedo al dashboard principal  
**Cuando** la p√°gina cargue completamente  
**Entonces** debo ver:
- Resumen ejecutivo con m√©tricas clave del d√≠a
- Total de m√°quinas monitoreadas y su estado
- Backups exitosos/fallidos en las √∫ltimas 24 horas
- Gr√°fico de tendencias de la √∫ltima semana
- Lista de alertas recientes m√°s importantes

#### ‚úÖ AC2: Monitoreo en Tiempo Real
**Dado** que tengo el dashboard abierto  
**Cuando** ocurra cualquier cambio de estado en las m√°quinas  
**Entonces** la interfaz debe:
- Actualizarse autom√°ticamente via WebSocket
- Mostrar notificaciones no intrusivas
- Actualizar m√©tricas y gr√°ficos en tiempo real
- Mantener sincronizaci√≥n sin refresh de p√°gina

#### ‚úÖ AC3: Vista Detallada de M√°quinas
**Dado** que necesito investigar el estado de una m√°quina espec√≠fica  
**Cuando** haga clic en una m√°quina desde la lista  
**Entonces** debo acceder a:
- Historial completo de backups
- Informaci√≥n detallada del sistema
- Logs de eventos y errores
- Configuraci√≥n de backup actual
- Gr√°ficos de performance y tendencias

### üîß Especificaciones T√©cnicas

#### Stack Frontend
```typescript
// Tecnolog√≠as principales
const frontendStack = {
  framework: "React 18",
  language: "TypeScript",
  bundler: "Vite",
  styling: "Tailwind CSS + Radix UI",
  state: "Zustand + React Query",
  routing: "React Router",
  charts: "Recharts",
  websockets: "Socket.io-client",
  forms: "React Hook Form + Zod",
  notifications: "React Hot Toast"
};
```

#### Componentes Principales
```typescript
// Layout Principal
interface DashboardLayoutProps {
  user: User;
  organization: Organization;
  children: React.ReactNode;
}

// Cards de M√©tricas
interface MetricCardProps {
  title: string;
  value: number | string;
  change: number;
  trend: 'up' | 'down' | 'stable';
  icon: React.ComponentType;
  color: 'green' | 'red' | 'yellow' | 'blue';
}

// Lista de M√°quinas
interface MachineListProps {
  machines: Machine[];
  onMachineSelect: (machine: Machine) => void;
  filters: MachineFilters;
  sortBy: MachineSortOptions;
}

// Gr√°fico de Tendencias
interface BackupTrendChartProps {
  data: BackupTrendData[];
  timeRange: '24h' | '7d' | '30d';
  metric: 'success_rate' | 'backup_count' | 'data_size';
}

// Centro de Notificaciones
interface NotificationCenterProps {
  notifications: BackupAlert[];
  onMarkAsRead: (id: string) => void;
  onMarkAllAsRead: () => void;
}
```

#### Mockup de Dashboard
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ BackupGuard Pro                    üîî(3) üìä ‚öôÔ∏è üë§ Admin           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                     ‚îÇ
‚îÇ üìä Resumen General                          üéØ Estado de Hoy        ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ ‚úÖ Saludables   ‚îÇ ‚îÇ üü° Advertencias ‚îÇ    ‚îÇ üìà Tendencia Semanal ‚îÇ ‚îÇ
‚îÇ ‚îÇ      42         ‚îÇ ‚îÇ       3         ‚îÇ    ‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà ‚îÇ ‚îÇ
‚îÇ ‚îÇ   +2 vs ayer    ‚îÇ ‚îÇ   +1 vs ayer    ‚îÇ    ‚îÇ 96% √©xito promedio   ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ üî¥ Cr√≠ticos     ‚îÇ ‚îÇ ‚ö´ Offline      ‚îÇ    ‚îÇ üíæ Datos Respaldados ‚îÇ ‚îÇ
‚îÇ ‚îÇ       0         ‚îÇ ‚îÇ       2         ‚îÇ    ‚îÇ      1.2 TB hoy      ‚îÇ ‚îÇ
‚îÇ ‚îÇ   =  vs ayer    ‚îÇ ‚îÇ   +1 vs ayer    ‚îÇ    ‚îÇ +340 GB vs ayer      ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îÇ üñ•Ô∏è M√°quinas Recientes                      üö® Alertas Activas      ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ ‚úÖ SERVER-DB-01    ‚îÇ √öltima: 2h ago ‚îÇ üü° SERVER-WEB-02          ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚úÖ WORKSTATION-05  ‚îÇ √öltima: 4h ago ‚îÇ    Backup retrasado 6h    ‚îÇ ‚îÇ
‚îÇ ‚îÇ üü° SERVER-WEB-02   ‚îÇ √öltima: 8h ago ‚îÇ üî¥ LAPTOP-SALES-01        ‚îÇ ‚îÇ
‚îÇ ‚îÇ üî¥ LAPTOP-SALES-01 ‚îÇ √öltima: 25h    ‚îÇ    Offline por 2 d√≠as     ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îÇ [Ver Todas las M√°quinas] [Generar Reporte] [Configurar Alertas]    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### üìã Tareas de Implementaci√≥n

- [ ] **Tarea 3.1** (Frontend): Setup proyecto React con Vite y TypeScript
- [ ] **Tarea 3.2** (Frontend): Crear layout base y sistema de navegaci√≥n
- [ ] **Tarea 3.3** (Frontend): Implementar componentes de m√©tricas y cards
- [ ] **Tarea 3.4** (Frontend): Crear lista de m√°quinas con filtros y b√∫squeda
- [ ] **Tarea 3.5** (Frontend): Integrar gr√°ficos de tendencias con Recharts
- [ ] **Tarea 3.6** (Frontend): Implementar WebSocket para updates en tiempo real
- [ ] **Tarea 3.7** (Frontend): Crear p√°ginas de detalle de m√°quinas
- [ ] **Tarea 3.8** (Frontend): Implementar centro de notificaciones
- [ ] **Tarea 3.9** (QA): Crear tests E2E para flujos principales del dashboard

---

## üîî HU 4: Sistema de Notificaciones B√°sicas

### üìä Estado
- **Status**: üî¥ Pending
- **Prioridad**: Media
- **Estimaci√≥n**: 1.5 semanas
- **Dependencias**: HU 2 (Backup Monitor)
- **Sprint**: Sprint 4

### üìù Descripci√≥n Funcional
**Como** usuario del sistema  
**Quiero** recibir notificaciones autom√°ticas sobre el estado de mis backups  
**Para que** pueda reaccionar r√°pidamente ante problemas y mantenerme informado del estado general.

### üéØ Criterios de Aceptaci√≥n

#### ‚úÖ AC1: Notificaciones por Email Autom√°ticas
**Dado** que soy usuario con notificaciones de email habilitadas  
**Cuando** ocurra un evento cr√≠tico en mis backups  
**Entonces** debo recibir:
- Email autom√°tico dentro de 5 minutos del evento
- Subject line descriptivo del problema
- Informaci√≥n detallada del problema y m√°quina afectada
- Enlaces directos para acceder al dashboard
- Bot√≥n de "Marcar como Resuelto"

#### ‚úÖ AC2: Notificaciones Push en Dashboard
**Dado** que tengo el dashboard abierto en mi navegador  
**Cuando** ocurra cualquier evento relevante  
**Entonces** debo ver:
- Notificaci√≥n toast no intrusiva en la esquina
- Icono de notificaci√≥n con counter en la navbar
- Lista de notificaciones en el notification center
- Opci√≥n de marcar como le√≠da individualmente

#### ‚úÖ AC3: Configuraci√≥n de Preferencias
**Dado** que quiero personalizar mis notificaciones  
**Cuando** acceda a la configuraci√≥n de notificaciones  
**Entonces** debo poder:
- Elegir tipos de eventos que quiero recibir
- Configurar canales (email, push, SMS futuro)
- Establecer frecuencia (inmediato, resumen horario/diario)
- Configurar horarios de silencio (no molestar)

### üîß Especificaciones T√©cnicas

#### Modelo de Datos
```typescript
interface NotificationEvent {
  _id: ObjectId;
  organizationId: ObjectId;
  type: 'backup_completed' | 'backup_failed' | 'machine_offline' | 'storage_full' | 'backup_missing';
  severity: 'info' | 'warning' | 'error' | 'critical';
  title: string;
  message: string;
  machineId?: ObjectId;
  metadata: {
    machineName?: string;
    backupId?: string;
    errorDetails?: string;
    duration?: number;
    fileSize?: number;
  };
  recipients: ObjectId[]; // user IDs
  deliveryStatus: {
    email: 'pending' | 'sent' | 'delivered' | 'failed';
    push: 'pending' | 'sent' | 'delivered' | 'failed';
    sms?: 'pending' | 'sent' | 'delivered' | 'failed';
  };
  createdAt: Date;
  scheduledFor?: Date;
}

interface UserNotificationPreference {
  userId: ObjectId;
  eventTypes: {
    backup_completed: boolean;
    backup_failed: boolean;
    machine_offline: boolean;
    storage_full: boolean;
    backup_missing: boolean;
  };
  channels: {
    email: boolean;
    push: boolean;
    sms: boolean;
  };
  frequency: 'immediate' | 'hourly_digest' | 'daily_digest';
  quietHours: {
    enabled: boolean;
    startTime: string; // "22:00"
    endTime: string;   // "08:00"
    timezone: string;
  };
  isEnabled: boolean;
  createdAt: Date;
  updatedAt: Date;
}
```

#### Email Templates
```typescript
interface EmailTemplate {
  type: 'backup_failed' | 'backup_missing' | 'machine_offline';
  subject: string;
  htmlTemplate: string;
  textTemplate: string;
  variables: string[]; // placeholders like {{machineName}}
}

// Ejemplo de template
const backupFailedTemplate: EmailTemplate = {
  type: 'backup_failed',
  subject: 'üö® Backup Failed - {{machineName}}',
  htmlTemplate: `
    <h2>Backup Failed on {{machineName}}</h2>
    <p>The backup process failed on {{machineName}} at {{timestamp}}.</p>
    <p><strong>Error:</strong> {{errorMessage}}</p>
    <a href="{{dashboardUrl}}" style="background: #007bff; color: white; padding: 10px 20px;">
      View Details
    </a>
  `,
  textTemplate: `
    Backup Failed on {{machineName}}
    
    The backup process failed at {{timestamp}}.
    Error: {{errorMessage}}
    
    View details: {{dashboardUrl}}
  `,
  variables: ['machineName', 'timestamp', 'errorMessage', 'dashboardUrl']
};
```

### üìã Tareas de Implementaci√≥n

- [ ] **Tarea 4.1** (Backend): Crear Notification Service con queue processing
- [ ] **Tarea 4.2** (Backend): Implementar integraci√≥n con SendGrid/AWS SES
- [ ] **Tarea 4.3** (Backend): Crear sistema de templates de email con Handlebars
- [ ] **Tarea 4.4** (Backend): Implementar push notifications via WebSocket
- [ ] **Tarea 4.5** (Backend): Crear gesti√≥n de preferencias de usuario
- [ ] **Tarea 4.6** (Backend): Implementar rate limiting y anti-spam
- [ ] **Tarea 4.7** (Frontend): Crear notification center en dashboard
- [ ] **Tarea 4.8** (Frontend): Implementar configuraci√≥n de preferencias
- [ ] **Tarea 4.9** (QA): Crear tests para diferentes tipos de notificaciones

---

## ü§ñ HU 5: Agente Cliente B√°sico

### üìä Estado
- **Status**: üî¥ Pending
- **Prioridad**: Alta
- **Estimaci√≥n**: 2.5 semanas
- **Dependencias**: HU 2 (Backup Monitor)
- **Sprint**: Sprint 4-5

### üìù Descripci√≥n Funcional
**Como** usuario que necesita monitorear backups en mis m√°quinas  
**Quiero** un agente ligero y f√°cil de instalar  
**Para que** mis m√°quinas se conecten autom√°ticamente al sistema central sin configuraci√≥n compleja.

### üéØ Criterios de Aceptaci√≥n

#### ‚úÖ AC1: Instalaci√≥n One-Click Multiplataforma
**Dado** que descargo el installer de BackupGuard  
**Cuando** ejecute el archivo de instalaci√≥n  
**Entonces** debe:
- Completar instalaci√≥n en menos de 60 segundos
- Auto-detectar el sistema operativo (Windows/Linux/macOS)
- Registrarse autom√°ticamente con el servidor central
- Iniciarse como servicio del sistema
- Mostrar wizard de configuraci√≥n b√°sica

#### ‚úÖ AC2: Detecci√≥n Autom√°tica de Backups
**Dado** que tengo software de backup existente instalado  
**Cuando** el agente se active por primera vez  
**Entonces** debe:
- Detectar configuraciones de Windows Backup
- Detectar Time Machine en macOS
- Identificar herramientas comunes de backup en Linux
- Sugerir carpetas importantes para monitorear
- Permitir configuraci√≥n manual adicional

#### ‚úÖ AC3: Comunicaci√≥n Resiliente
**Dado** que la m√°quina puede tener conectividad intermitente  
**Cuando** se pierda la conexi√≥n temporalmente  
**Entonces** el agente debe:
- Almacenar eventos localmente en SQLite
- Continuar monitoreando archivos offline
- Reintentar conexi√≥n autom√°ticamente
- Sincronizar datos acumulados al reconectarse
- Mantener heartbeat cada 60 segundos cuando est√© online

### üîß Especificaciones T√©cnicas

#### Arquitectura del Agente (Go)
```go
// Estructura principal del agente
type BackupAgent struct {
    Config       *AgentConfig
    HTTPClient   *http.Client
    WebSocket    *websocket.Conn
    LocalDB      *sql.DB
    FileWatcher  *fsnotify.Watcher
    Scheduler    *cron.Cron
    Logger       *logrus.Logger
}

type AgentConfig struct {
    ServerURL     string `json:"server_url"`
    APIKey        string `json:"api_key"`
    MachineID     string `json:"machine_id"`
    Organization  string `json:"organization"`
    MonitorPaths  []string `json:"monitor_paths"`
    BackupTools   []BackupTool `json:"backup_tools"`
    HeartbeatInterval int `json:"heartbeat_interval"` // seconds
}

type BackupEvent struct {
    ID           string    `json:"id"`
    Timestamp    time.Time `json:"timestamp"`
    Type         string    `json:"type"` // "started", "completed", "failed"
    Path         string    `json:"path"`
    Size         int64     `json:"size"`
    Checksum     string    `json:"checksum"`
    Duration     int       `json:"duration"` // seconds
    ErrorMessage string    `json:"error_message,omitempty"`
    Metadata     map[string]interface{} `json:"metadata"`
}
```

#### Funcionalidades Core
```go
// Detecci√≥n de herramientas de backup
func (a *BackupAgent) DetectBackupTools() []BackupTool {
    var tools []BackupTool
    
    switch runtime.GOOS {
    case "windows":
        tools = append(tools, a.detectWindowsBackup()...)
        tools = append(tools, a.detectCommonTools()...)
    case "darwin":
        tools = append(tools, a.detectTimeMachine()...)
        tools = append(tools, a.detectCommonTools()...)
    case "linux":
        tools = append(tools, a.detectLinuxTools()...)
    }
    
    return tools
}

// Monitoreo de archivos
func (a *BackupAgent) StartFileWatcher() error {
    watcher, err := fsnotify.NewWatcher()
    if err != nil {
        return err
    }
    
    for _, path := range a.Config.MonitorPaths {
        err = watcher.Add(path)
        if err != nil {
            a.Logger.Warnf("Failed to watch path %s: %v", path, err)
        }
    }
    
    go a.processFileEvents(watcher)
    return nil
}

// C√°lculo de checksum
func (a *BackupAgent) CalculateChecksum(filePath string) (string, error) {
    file, err := os.Open(filePath)
    if err != nil {
        return "", err
    }
    defer file.Close()
    
    hash := sha256.New()
    if _, err := io.Copy(hash, file); err != nil {
        return "", err
    }
    
    return fmt.Sprintf("%x", hash.Sum(nil)), nil
}
```

#### Instalador Multiplataforma
```bash
# Windows (PowerShell)
Invoke-WebRequest -Uri "https://releases.backupguard.pro/latest/windows/installer.exe" -OutFile "installer.exe"
.\installer.exe /S /organization="MyCompany" /server="https://api.backupguard.pro"

# macOS (Homebrew)
brew install backupguard/tap/backupguard-agent
backupguard-agent setup --organization="MyCompany"

# Linux (curl + bash)
curl -fsSL https://install.backupguard.pro | bash -s -- --org="MyCompany"
```

### üìã Tareas de Implementaci√≥n

- [ ] **Tarea 5.1** (Backend/Go): Crear estructura base del agente en Go
- [ ] **Tarea 5.2** (Backend/Go): Implementar comunicaci√≥n WebSocket bidireccional
- [ ] **Tarea 5.3** (Backend/Go): Crear sistema de detecci√≥n de backup tools
- [ ] **Tarea 5.4** (Backend/Go): Implementar file system monitoring con fsnotify
- [ ] **Tarea 5.5** (Backend/Go): Crear cache local con SQLite para offline mode
- [ ] **Tarea 5.6** (DevOps): Crear instaladores para Windows, macOS, Linux
- [ ] **Tarea 5.7** (Backend/Go): Implementar sistema de auto-actualizaci√≥n
- [ ] **Tarea 5.8** (Backend/Go): Crear configuraci√≥n via archivo y CLI
- [ ] **Tarea 5.9** (QA): Testing en m√∫ltiples sistemas operativos

---

## üåê HU 6: API Gateway y Orquestaci√≥n

### üìä Estado
- **Status**: üî¥ Pending
- **Prioridad**: Media
- **Estimaci√≥n**: 1.5 semanas
- **Dependencias**: HU 1 (Auth), HU 2 (Backup Monitor)
- **Sprint**: Sprint 3

### üìù Descripci√≥n Funcional
**Como** arquitecto del sistema  
**Quiero** un API Gateway que centralice el acceso a todos los microservicios  
**Para que** tengamos un punto de entrada √∫nico, autenticaci√≥n centralizada y capacidades de monitoring unificadas.

### üéØ Criterios de Aceptaci√≥n

#### ‚úÖ AC1: Routing Inteligente y Load Balancing
**Dado** que un cliente hace una request a cualquier endpoint  
**Cuando** la request llegue al API Gateway  
**Entonces** debe:
- Rutear autom√°ticamente al microservicio correcto
- Aplicar load balancing entre instancias
- Manejar circuit breaker para servicios ca√≠dos
- Retornar respuestas consistentes con c√≥digos de error est√°ndar

#### ‚úÖ AC2: Autenticaci√≥n y Autorizaci√≥n Centralizada
**Dado** que llega una request que requiere autenticaci√≥n  
**Cuando** el gateway procese la request  
**Entonces** debe:
- Validar JWT tokens autom√°ticamente
- Verificar permisos basados en roles
- Pasar informaci√≥n de usuario a microservicios
- Manejar refresh de tokens autom√°ticamente

#### ‚úÖ AC3: Rate Limiting y Throttling
**Dado** que un usuario/IP hace muchas requests  
**Cuando** exceda los l√≠mites configurados  
**Entonces** debe:
- Aplicar rate limiting por usuario y por IP
- Retornar HTTP 429 con headers informativos
- Implementar diferentes l√≠mites por plan (free/premium)
- Permitir burst requests dentro de l√≠mites

### üîß Especificaciones T√©cnicas

#### Configuraci√≥n del Gateway
```typescript
// Express Gateway Configuration
interface GatewayConfig {
  http: {
    port: 8080;
    hostname: '0.0.0.0';
  };
  apiEndpoints: {
    userAPI: {
      host: 'localhost';
      paths: ['/api/auth/*', '/api/users/*', '/api/organizations/*'];
    };
    backupAPI: {
      host: 'localhost';  
      paths: ['/api/machines/*', '/api/backups/*', '/api/alerts/*'];
    };
    notificationAPI: {
      host: 'localhost';
      paths: ['/api/notifications/*', '/api/preferences/*'];
    };
  };
  serviceEndpoints: {
    userService: {
      url: 'http://user-service:3001';
    };
    backupService: {
      url: 'http://backup-service:3002';
    };
    notificationService: {
      url: 'http://notification-service:3003';
    };
  };
}
```

#### Middleware Stack
```typescript
// Middleware de autenticaci√≥n
const authMiddleware = async (req: Request, res: Response, next: NextFunction) => {
  try {
    const token = extractTokenFromHeader(req);
    const payload = await verifyJWT(token);
    req.user = payload;
    req.headers['x-user-id'] = payload.id;
    req.headers['x-organization-id'] = payload.organizationId;
    next();
  } catch (error) {
    return res.status(401).json({ error: 'Invalid authentication token' });
  }
};

// Rate limiting middleware  
const rateLimitMiddleware = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutes
  max: (req: Request) => {
    const user = req.user as any;
    return user?.plan === 'premium' ? 1000 : 100; // requests per window
  },
  message: {
    error: 'Too many requests',
    retryAfter: '15 minutes'
  },
  standardHeaders: true,
  legacyHeaders: false,
});

// Circuit breaker middleware
const circuitBreakerMiddleware = (serviceName: string) => {
  const breaker = new CircuitBreaker(proxyToService, {
    timeout: 5000,
    errorThresholdPercentage: 50,
    resetTimeout: 30000
  });
  
  return async (req: Request, res: Response, next: NextFunction) => {
    try {
      const response = await breaker.fire(serviceName, req);
      res.json(response);
    } catch (error) {
      res.status(503).json({ 
        error: 'Service temporarily unavailable',
        service: serviceName 
      });
    }
  };
};
```

### üìã Tareas de Implementaci√≥n

- [ ] **Tarea 6.1** (DevOps): Setup y configuraci√≥n de Express Gateway
- [ ] **Tarea 6.2** (Backend): Configurar service discovery y health checks
- [ ] **Tarea 6.3** (Backend): Implementar middleware de autenticaci√≥n JWT
- [ ] **Tarea 6.4** (Backend): Configurar rate limiting por usuario y plan
- [ ] **Tarea 6.5** (Backend): Implementar circuit breaker pattern
- [ ] **Tarea 6.6** (DevOps): Configurar logging y m√©tricas centralizadas
- [ ] **Tarea 6.7** (Backend): Crear sistema de health monitoring
- [ ] **Tarea 6.8** (QA): Crear tests de carga para el gateway
- [ ] **Tarea 6.9** (Docs): Documentar configuraci√≥n y troubleshooting

---

## üöÄ HU 7: Infraestructura y Deployment Base

### üìä Estado
- **Status**: üî¥ Pending
- **Prioridad**: Media
- **Estimaci√≥n**: 2 semanas
- **Dependencias**: Todas las HUs anteriores
- **Sprint**: Sprint 5-6

### üìù Descripci√≥n Funcional
**Como** DevOps engineer  
**Quiero** una infraestructura automatizada y reproducible  
**Para que** podamos deployar, escalar y mantener el sistema de manera eficiente y confiable en producci√≥n.

### üéØ Criterios de Aceptaci√≥n

#### ‚úÖ AC1: Deployment Automatizado
**Dado** que se hace push a la rama main  
**Cuando** el CI/CD pipeline se active  
**Entonces** debe:
- Ejecutar todos los tests (unit, integration, E2E)
- Construir containers Docker para cada servicio
- Deployar autom√°ticamente a staging
- Ejecutar smoke tests en staging
- Permitir promoci√≥n manual a producci√≥n

#### ‚úÖ AC2: Rollback R√°pido y Seguro
**Dado** que se detecta un problema en producci√≥n  
**Cuando** se active el proceso de rollback  
**Entonces** debe:
- Revertir a la versi√≥n anterior en menos de 2 minutos
- Mantener la integridad de la base de datos
- Notificar autom√°ticamente al equipo
- Generar logs detallados del proceso

#### ‚úÖ AC3: Escalado Autom√°tico Basado en Demanda
**Dado** que el sistema experimenta alta carga  
**Cuando** las m√©tricas excedan umbrales definidos  
**Entonces** debe:
- Escalar horizontalmente los pods autom√°ticamente
- Balancear carga entre instancias nuevas
- Monitorear m√©tricas de performance continuamente
- Escalar hacia abajo cuando la demanda disminuya

### üîß Especificaciones T√©cnicas

#### Stack de Infraestructura
```yaml
# docker-compose.yml para desarrollo
version: '3.8'
services:
  api-gateway:
    build: ./services/api-gateway
    ports: ["8080:8080"]
    environment:
      - NODE_ENV=development
      - REDIS_URL=redis://redis:6379
      - USER_SERVICE_URL=http://user-service:3001
    depends_on: [redis, user-service]
    
  user-service:
    build: ./services/user-service  
    ports: ["3001:3001"]
    environment:
      - NODE_ENV=development
      - MONGODB_URL=mongodb://mongo:27017/backupguard
      - JWT_SECRET=${JWT_SECRET}
    depends_on: [mongodb]
    
  backup-service:
    build: ./services/backup-monitor-service
    ports: ["3002:3002", "8000:8000"]
    environment:
      - NODE_ENV=development  
      - MONGODB_URL=mongodb://mongo:27017/backupguard
      - WEBSOCKET_PORT=8000
    depends_on: [mongodb, redis, rabbitmq]
```

#### Kubernetes Manifests
```yaml
# deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: user-service
spec:
  replicas: 3
  selector:
    matchLabels:
      app: user-service
  template:
    metadata:
      labels:
        app: user-service
    spec:
      containers:
      - name: user-service
        image: backupguard/user-service:latest
        ports:
        - containerPort: 3001
        env:
        - name: MONGODB_URL
          valueFrom:
            secretKeyRef:
              name: mongodb-secret
              key: connection-string
        - name: JWT_SECRET
          valueFrom:
            secretKeyRef:
              name: jwt-secret
              key: secret
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi" 
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /health
            port: 3001
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /ready
            port: 3001
          initialDelaySeconds: 5
          periodSeconds: 5

---
apiVersion: v1
kind: Service
metadata:
  name: user-service
spec:
  selector:
    app: user-service
  ports:
  - port: 3001
    targetPort: 3001
  type: ClusterIP

---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: user-service-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: user-service
  minReplicas: 2
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
```

#### GitHub Actions CI/CD
```yaml
# .github/workflows/ci-cd.yml
name: CI/CD Pipeline
on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    services:
      mongodb:
        image: mongo:7.0
        ports: ["27017:27017"]
      redis:
        image: redis:7.2
        ports: ["6379:6379"]
        
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          
      - name: Install dependencies
        run: npm ci
        
      - name: Run unit tests
        run: npm run test:unit
        
      - name: Run integration tests  
        run: npm run test:integration
        
      - name: Upload coverage
        uses: codecov/codecov-action@v3
        
  build:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
      - uses: actions/checkout@v4
      - name: Build and push Docker images
        run: |
          echo ${{ secrets.DOCKER_PASSWORD }} | docker login -u ${{ secrets.DOCKER_USERNAME }} --password-stdin
          docker build -t backupguard/user-service:${{ github.sha }} ./services/user-service
          docker push backupguard/user-service:${{ github.sha }}
          
  deploy-staging:
    needs: build
    runs-on: ubuntu-latest
    environment: staging
    
    steps:
      - name: Deploy to staging
        run: |
          kubectl set image deployment/user-service user-service=backupguard/user-service:${{ github.sha }}
          kubectl rollout status deployment/user-service
          
      - name: Run smoke tests
        run: npm run test:smoke -- --env=staging
        
  deploy-production:
    needs: deploy-staging
    runs-on: ubuntu-latest
    environment: production
    if: github.ref == 'refs/heads/main'
    
    steps:
      - name: Deploy to production
        run: |
          kubectl set image deployment/user-service user-service=backupguard/user-service:${{ github.sha }}
          kubectl rollout status deployment/user-service
```

### üìã Tareas de Implementaci√≥n

- [ ] **Tarea 7.1** (DevOps): Crear Dockerfiles optimizados para cada microservicio
- [ ] **Tarea 7.2** (DevOps): Setup de docker-compose para desarrollo local
- [ ] **Tarea 7.3** (DevOps): Configurar GitHub Actions para CI/CD completo
- [ ] **Tarea 7.4** (DevOps): Crear manifiestos de Kubernetes para todos los servicios
- [ ] **Tarea 7.5** (DevOps): Setup de Prometheus y Grafana para monitoring
- [ ] **Tarea 7.6** (DevOps): Configurar ELK stack para centralized logging
- [ ] **Tarea 7.7** (DevOps): Implementar health checks y readiness probes
- [ ] **Tarea 7.8** (DevOps): Crear scripts de rollback automatizado
- [ ] **Tarea 7.9** (QA): Testing de infraestructura y disaster recovery

---

## üìä Resumen de Historias de Usuario

### Distribuci√≥n por Sprint
```
Sprint 1 (2 semanas):
‚îú‚îÄ HU 0: Dise√±o Arquitect√≥nico ‚≠ê (CR√çTICA)

Sprint 2 (2 semanas):
‚îú‚îÄ HU 1: Sistema de Autenticaci√≥n
‚îî‚îÄ HU 2: Backup Monitor Service (inicio)

Sprint 3 (2 semanas):  
‚îú‚îÄ HU 2: Backup Monitor Service (finalizaci√≥n)
‚îú‚îÄ HU 6: API Gateway
‚îî‚îÄ HU 3: Dashboard Admin (inicio)

Sprint 4 (2 semanas):
‚îú‚îÄ HU 3: Dashboard Admin (finalizaci√≥n)
‚îú‚îÄ HU 4: Sistema de Notificaciones
‚îî‚îÄ HU 5: Agente Cliente (inicio)

Sprint 5 (2 semanas):
‚îú‚îÄ HU 5: Agente Cliente (finalizaci√≥n)
‚îî‚îÄ HU 7: Infraestructura (inicio)

Sprint 6 (2 semanas):
‚îú‚îÄ HU 7: Infraestructura (finalizaci√≥n)
‚îú‚îÄ Testing E2E completo
‚îî‚îÄ Preparaci√≥n para launch
```

### M√©tricas de Estimaci√≥n
- **Total HUs**: 7 (incluyendo HU 0 obligatoria)
- **Estimaci√≥n Total**: 12 semanas
- **HUs Cr√≠ticas**: 4 (HU 0, 1, 2, 3)
- **HUs de Infraestructura**: 2 (HU 6, 7)
- **Dependencias Cr√≠ticas**: HU 0 ‚Üí Todas las dem√°s

### Definition of Ready ‚úÖ
Cada HU est√° "Ready" cuando tiene:
- [x] Descripci√≥n funcional clara
- [x] Criterios de aceptaci√≥n espec√≠ficos y testeable  
- [x] Especificaciones t√©cnicas detalladas
- [x] Tareas de implementaci√≥n definidas
- [x] Dependencias identificadas
- [x] Estimaci√≥n de esfuerzo

### Definition of Done üéØ
Cada HU estar√° "Done" cuando:
- [ ] C√≥digo implementado siguiendo est√°ndares
- [ ] Tests unitarios con cobertura > 80%
- [ ] Tests de integraci√≥n pasando
- [ ] Code review aprobado por tech lead
- [ ] Documentaci√≥n actualizada
- [ ] Funcionalidad validada en staging
- [ ] Aprobaci√≥n del Product Owner

---

**Documento Versi√≥n**: 1.0  
**√öltima Actualizaci√≥n**: 16 de agosto de 2025  
**Pr√≥xima Revisi√≥n**: Al finalizar HU 0 (Arquitectura)
